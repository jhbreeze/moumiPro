<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sales">
	<select id="todaySales" resultType="map">
		SELECT COUNT(*) count, NVL(SUM(paymentPrice), 0) total
		FROM payment
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(SYSDATE, 'YYYY-MM-DD')
	</select>
	
	<select id="monthSales" resultType="map">
		SELECT COUNT(*) count, NVL(SUM(paymentPrice), 0) total
		FROM payment
		WHERE TO_CHAR(payDate, 'YYYYMM') = TO_CHAR(SYSDATE, 'YYYYMM')
	</select>
	
	<select id="previousMonthSales" resultType="map">
		SELECT COUNT(*) count, NVL(SUM(paymentPrice), 0) total
		FROM payment
		WHERE TO_CHAR(payDate, 'YYYYMM') = TO_CHAR(ADD_MONTHS(SYSDATE, -1), 'YYYYMM')
	</select>
	
	<select id="dayTotalSales"  parameterType="String" resultType="map">
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-6, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-6, 'YYYY-MM-DD') 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-5, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-5, 'YYYY-MM-DD') 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-4, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-4, 'YYYY-MM-DD') 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-3, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-3, 'YYYY-MM-DD') 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-2, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-2, 'YYYY-MM-DD') 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-1, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-1, 'YYYY-MM-DD') 
		  UNION ALL
		  
		SELECT #{date} payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = #{date} 
	</select>
	
	<select id="dayTotalSalesW"  parameterType="String" resultType="map">
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-6, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment p  
		JOIN member m ON p.userCode = m.userCode
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-6, 'YYYY-MM-DD') AND GENDER = '여자'
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-5, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-5, 'YYYY-MM-DD') AND GENDER = '여자'
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-4, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-4, 'YYYY-MM-DD') AND GENDER = '여자' 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-3, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-3, 'YYYY-MM-DD') AND GENDER = '여자' 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-2, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-2, 'YYYY-MM-DD') AND GENDER = '여자' 
		  UNION ALL
		  
		SELECT TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-1, 'YYYY-MM-DD') payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = TO_CHAR(TO_DATE(#{date}, 'YYYY-MM-DD')-1, 'YYYY-MM-DD') AND GENDER = '여자' 
		  UNION ALL
		  
		SELECT #{date} payDate, 
				NVL(SUM(paymentPrice), 0) paymentPrice 
		FROM payment 
		WHERE TO_CHAR(payDate, 'YYYY-MM-DD') = #{date} AND GENDER = '여자' 
	</select>
</mapper>